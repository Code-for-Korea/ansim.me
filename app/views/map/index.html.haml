- google_map_apikey = 'AIzaSyBmxQGhxC-UzPzxIMlE9Sy09Dv9zUtiiW4'
%section.section-map-panel
  %section.picket-map{ style: 'width: 100vw; height: 100vh' }
    #map{ style: 'width: 100%; height: 100%' }
    %script{:src => "https://maps.googleapis.com/maps/api/js?key=#{google_map_apikey}"}

= content_for :script do
  :javascript
    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 10,
      center: new google.maps.LatLng(37.541, 126.986),
      mapTypeId: 'terrain' // google.maps.MapTypeId.ROADMAP
    });

    var circle = {
        path: google.maps.SymbolPath.CIRCLE,
        fillColor: 'green',
        fillOpacity: .8,
        scale: 7.5,
        strokeColor: 'white',
        strokeWeight: 1
    };

    var places = #{raw(@places.to_json)}
    /*
    var places = [
      [01,34840559,"신신약국","충청남도 홍성군 갈산면 상촌로 12-1",36.6029863,126.5489114],
      [01,37844571,"밝은온누리약국","대구광역시 달서구 달구벌대로 1736 1층 (두류동)",35.856678,128.5552778]
    ];*/
    var bounds = new google.maps.LatLngBounds();
    var activeInfoWindow = new google.maps.InfoWindow();

    var infoview = '';
    for(i=0; i<places.length; i++) {
      const [type, id, name, address, latitude, longitude ] = places[i];
      const infoWindow = new google.maps.InfoWindow({
          content: name
        });
      const marker = new google.maps.Marker({
        position: new google.maps.LatLng(latitude, longitude),
        map: map,
        // icon: '#{image_url('picket.png')}',
        icon: {
          url: "http://maps.google.com/mapfiles/ms/icons/#{ ["blue", "yellow", "pink"].shuffle.first }-dot.png",
        },
        picket: places[i]
      });

      bounds.extend(marker.position);
      marker.addListener('click', function() {
        if (activeInfoWindow != null) {
          activeInfoWindow.close();
        }

        infoWindow.open(map, marker);

        activeInfoWindow = infoWindow;
      });
    };

    if (places.length > 1) {
      map.fitBounds(bounds);
    } else if (places.length == 1) {
      map.setCenter(bounds.getCenter());
      map.setZoom(10);
    }
= yield :script if content_for?(:script)